# CI-specific values for the Archestra Helm chart
# This file is used during e2e testing in GitHub Actions

archestra:
  # Image will be set via --set during deployment
  # image: archestra/platform:ci-test

  # Deploy multiple replicas for the e2e environment to test issues we may face
  # which could be caused by storing state in pod memory, which may only be discovered
  # when replicas is > 1
  replicaCount: 5

  # Environment variables for e2e testing
  env:
    ARCHESTRA_ANALYTICS: disabled
    # LLM Proxy base URLs (for LLM proxy routes)
    # Each provider uses a distinct path prefix to avoid WireMock stub conflicts
    ARCHESTRA_OPENAI_BASE_URL: "http://e2e-tests-wiremock:8080/openai/v1"
    ARCHESTRA_ANTHROPIC_BASE_URL: "http://e2e-tests-wiremock:8080/anthropic"
    ARCHESTRA_GEMINI_BASE_URL: "http://e2e-tests-wiremock:8080/gemini"
    ARCHESTRA_COHERE_BASE_URL: "http://e2e-tests-wiremock:8080/cohere"
    ARCHESTRA_CEREBRAS_BASE_URL: "http://e2e-tests-wiremock:8080/cerebras/v1"
    ARCHESTRA_VLLM_BASE_URL: "http://e2e-tests-wiremock:8080/vllm/v1"
    ARCHESTRA_OLLAMA_BASE_URL: "http://e2e-tests-wiremock:8080/ollama/v1"
    ARCHESTRA_ZHIPUAI_BASE_URL: "http://e2e-tests-wiremock:8080/zhipuai/v4"
    ARCHESTRA_MISTRAL_BASE_URL: "http://e2e-tests-wiremock:8080/mistral/v1"
    # Chat API keys (for e2e testing)
    ARCHESTRA_CHAT_OPENAI_API_KEY: test-key
    ARCHESTRA_CHAT_ANTHROPIC_API_KEY: test-key
    ARCHESTRA_CHAT_GEMINI_API_KEY: test-key
    ARCHESTRA_CHAT_COHERE_API_KEY: test-key
    ARCHESTRA_CHAT_CEREBRAS_API_KEY: test-key
    ARCHESTRA_CHAT_VLLM_API_KEY: test-key
    ARCHESTRA_CHAT_OLLAMA_API_KEY: test-key
    ARCHESTRA_CHAT_ZHIPUAI_API_KEY: test-key
    ARCHESTRA_CHAT_MISTRAL_API_KEY: test-key
    ARCHESTRA_METRICS_SECRET: "foo-bar"
    ARCHESTRA_FRONTEND_URL: "http://localhost:3000"
    ARCHESTRA_AUTH_SECRET: "e2e-auth-secret-must-be-32-chars-long"
    # Enable enterprise license for e2e tests (required for SSO tests)
    ARCHESTRA_ENTERPRISE_LICENSE_ACTIVATED: "true"
    # Enable test MCP server seeding
    ENABLE_TEST_MCP_SERVER: "true"
    # Disable better-auth rate limit for e2e tests
    ARCHESTRA_AUTH_RATE_LIMIT_DISABLED: "true"
    # Add Keycloak as trusted origin for SSO e2e tests (OIDC discovery URL validation)
    # Includes both the internal K8s service name and the NodePort URL that appears in OIDC discovery
    ARCHESTRA_AUTH_ADDITIONAL_TRUSTED_ORIGINS: "http://e2e-tests-keycloak:8080,http://localhost:30081"
    # Secrets manager configuration for BYOS tests
    ARCHESTRA_SECRETS_MANAGER: "Vault"
    # Vault configuration for BYOS tests
    # Vault runs as a Kubernetes service in the cluster
    # Pods access via K8s service name, host/Playwright access via NodePort mapped to 8200
    ARCHESTRA_HASHICORP_VAULT_ADDR: "http://vault:8200"
    ARCHESTRA_HASHICORP_VAULT_TOKEN: "dev-root-token"
    ARCHESTRA_HASHICORP_VAULT_AUTH_METHOD: "TOKEN"

  # Use NodePort service type to expose services on fixed ports
  service:
    type: NodePort
    nodePorts:
      backend: 30000
      metrics: 30050
      frontend: 30300

# PostgreSQL configuration for CI
postgresql:
  # Use the internal PostgreSQL instance
  external_database_url: null
  enabled: true
  auth:
    database: archestra_dev
    username: archestra
    password: archestra_dev_password
  # Use NodePort to expose PostgreSQL for debugging if needed
  primary:
    service:
      type: NodePort
      nodePorts:
        postgresql: 30432
